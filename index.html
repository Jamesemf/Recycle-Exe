<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Template</title>
</head>

<body>

    <p>Click the button to get your coordinates.</p>

    <button onclick="getLocation()">Try It</button>

    <p id="demo"></p>

    <script>
        var x = document.getElementById("demo");

        function closestBin() {
            // Get DB data about bins
            // Go through each bin etc. to find closest bin

            var testBins = [[50.730827200860205, -3.5159728963712626], [50, 7], [50, 3], [50, 7]];
            var minBinDist = [0, testBins[0], 0] // index, element, distance

            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(binDistCalc);
                } else {
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function binDistCalc(position) {
                var lat = position.coords.latitude;
                var long = position.coords.longitude;

                // Loop through test bins array and compare each set of values
                for (let y = 0; y < testBins.length; y++) {
                    var binLat = testBins[y][0];
                    var binLong = testBins[y][1];

                    var distance = calculateDistance(lat, long, binLat, binLong);

                    if (y == 0) {
                        minBinDist = [];
                        minBinDist = [y, testBins[y], distance]; 
                    } else {
                        if (distance < minBinDist[2]) {
                            minBinDist = [];
                            minBinDist = [y, testBins[y], distance];
                        }
                    }                    
                }
                console.log(minBinDist);
            }
            getLocation();
        }

        function binDistance() {
            // Get DB data about bins
            // Go through each bin etc. until found (from QR code)

            var binLat = 50.730827200860205;
            var binLong = -3.5159728963712626;
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(binDistCalc);
                } else {
                    x.innerHTML = "Geolocation is not supported by this browser.";
                }
            }
            function binDistCalc(position) {
                var lat = position.coords.latitude;
                var long = position.coords.longitude;

                //calculate the distance between user and a given location (bin)
                var distance = calculateDistance(lat, long, binLat, binLong);

                // checks the tolerence
                console.log(tolerance(distance));
            }
            getLocation();
        }


        function calculateDistance(lat1, lon1, lat2, lon2) {
            var R = 6371; // Radius of the earth in km
            var dLat = deg2rad(lat2 - lat1);  // deg2rad below
            var dLon = deg2rad(lon2 - lon1);
            var a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2)
                ;
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            var d = 1000 * R * c; // Distance in m

            return d;
        }
        function deg2rad(deg) {
            return deg * (Math.PI / 180);
        }
        function tolerance(distance) {
            if (distance < 25) {
                return true;
            } else {
                return false;
            }
        }
    </script>
</body>

</html>